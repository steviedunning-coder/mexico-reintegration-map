<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Mexico Reintegration & Integration Landscape (2026)</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
  body { margin:0; font-family: system-ui, sans-serif; }
  #map { height: 100vh; }

  .legend {
    background: white;
    padding: 12px;
    font-size: 13px;
    line-height: 1.4;
    border-radius: 6px;
    box-shadow: 0 0 6px rgba(0,0,0,.25);
  }

  .lang-toggle {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 999;
    background: white;
    padding: 6px 10px;
    border-radius: 6px;
    cursor: pointer;
    box-shadow: 0 0 4px rgba(0,0,0,.2);
    font-size: 13px;
  }
</style>
</head>

<body>
<div class="lang-toggle" onclick="toggleLang()">EN / ES</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let lang = "en";

// ---------------- BASE MAP ----------------
const map = L.map('map').setView([23.8, -102.5], 5);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '¬© OpenStreetMap'
}).addTo(map);

// ---------------- STATE DATA ----------------
const states = [
 ["Oaxaca",17.07,-96.73,49000,6000,"state","Oaxaca es tu Tierra","https://www.oaxaca.gob.mx"],
 ["Guanajuato",21.02,-101.26,48000,6000,"state","MigranteQuiero","https://migrantequiero.guanajuato.gob.mx"],
 ["Puebla",19.04,-98.21,47000,7000,"state","IPAM Puebla",""],
 ["Michoac√°n",19.57,-101.71,56000,5000,"state","Productive return pilots",""],
 ["Chiapas",16.76,-93.13,28000,120000,"federal","COMAR + labor pathways","https://www.gob.mx/comar"],
 ["Baja California",32.51,-117.04,42000,38000,"federal","M√©xico Te Abraza","https://www.gob.mx/migracion"]
];

// ---------------- MUNICIPAL HUBS ----------------
const municipalHubs = [
 ["Tijuana",32.5149,-117.0382],
 ["Ciudad Ju√°rez",31.6904,-106.4245],
 ["Tapachula",14.906,-92.263],
 ["Mexico City",19.4326,-99.1332],
 ["Monterrey",25.6866,-100.3161],
 ["Puebla",19.0414,-98.2063],
 ["Guadalajara",20.6597,-103.3496],
 ["Oaxaca de Ju√°rez",17.0732,-96.7266]
];

// ---------------- LAYERS ----------------
const nationals = L.layerGroup();
const nonNationals = L.layerGroup();
const federalPrograms = L.layerGroup();
const statePrograms = L.layerGroup();
const municipalLayer = L.layerGroup();

states.forEach(s => {
 const [name,lat,lon,nat,non,level,program,link] = s;
 const total = nat + non;

 const popup = () => `
  <b>${name}</b><br/>
  ${lang==="en" ? "Estimated 2026 events" : "Eventos estimados 2026"}:<br/>
  ${lang==="en" ? "Mexican nationals" : "Nacionales mexicanos"}: ${nat.toLocaleString()}<br/>
  ${lang==="en" ? "Non-Mexicans" : "Personas no mexicanas"}: ${non.toLocaleString()}<br/><br/>
  ${lang==="en" ? "Program" : "Programa"}: ${program}<br/>
  ${link ? `<a href="${link}" target="_blank">${lang==="en"?"Link":"Enlace"}</a>` : ""}
 `;

 if (nat>0){
  L.circleMarker([lat,lon],{
   radius:Math.sqrt(total)/12,
   color:"#1f77b4",
   fillOpacity:.7
  }).bindPopup(popup).addTo(nationals);
 }

 if (non>0){
  L.circleMarker([lat,lon],{
   radius:Math.sqrt(total)/12,
   color:"#ff7f0e",
   fillOpacity:.6
  }).bindPopup(popup).addTo(nonNationals);
 }

 if(level==="federal") federalPrograms.addLayer(L.circle([lat,lon],{radius:30000}));
 if(level==="state") statePrograms.addLayer(L.circle([lat,lon],{radius:30000}));
});

// Municipal hubs
municipalHubs.forEach(h=>{
 L.marker([h[1],h[2]])
  .bindPopup(`<b>${h[0]}</b><br/>Municipal integration hub`)
  .addTo(municipalLayer);
});

nationals.addTo(map);
nonNationals.addTo(map);
municipalLayer.addTo(map);

// ---------------- CONTROLS ----------------
const controls = L.control.layers(null,{
 "Mexican nationals returned/deported": nationals,
 "Non-Mexican integration events": nonNationals,
 "Federal programs (incl. M√©xico Te Abraza)": federalPrograms,
 "State-level programs": statePrograms,
 "Municipal integration hubs": municipalLayer
},{collapsed:false}).addTo(map);

// ---------------- LEGEND ----------------
const legend = L.control({position:"bottomright"});
legend.onAdd = function(){
 const div = L.DomUtil.create("div","legend");
 div.innerHTML = `
  <b>${lang==="en"?"Map guide":"Gu√≠a del mapa"}</b><br/><br/>
  üîµ ${lang==="en"?"Mexican nationals":"Nacionales mexicanos"}<br/>
  üü† ${lang==="en"?"Non-Mexicans":"Personas no mexicanas"}<br/>
  üìç ${lang==="en"?"Municipal hub":"Nodo municipal"}<br/><br/>
  ${lang==="en"?"Circle size = 2026 events":"Tama√±o = eventos 2026"}<br/>
  ${lang==="en"?"Data aligned with Pol√≠tica Migratoria (2025)":"Datos alineados con Pol√≠tica Migratoria (2025)"}
 `;
 return div;
};
legend.addTo(map);

// ---------------- LANGUAGE TOGGLE ----------------
function toggleLang(){
 lang = lang==="en" ? "es" : "en";
 map.eachLayer(l=>{
  if(l.getPopup) {
   const p = l.getPopup();
   if(p) l.bindPopup(p.getContent());
  }
 });
 legend.remove();
 legend.addTo(map);
}
</script>
</body>
</html>

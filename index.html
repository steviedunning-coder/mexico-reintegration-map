<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Mexico Reintegration Landscape</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Leaflet CSS/JS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  body { margin:0; font-family: system-ui, sans-serif; }
  #map { height: 90vh; width: 100%; }
  .legend { background:white; padding:10px; font-size:14px; line-height:1.5em; }
  .lang-toggle { position:absolute; top:10px; right:10px; z-index:1000; background:white; padding:5px 10px; border-radius:4px; cursor:pointer; }
</style>
</head>

<body>
<h2 style="padding:10px;">Mexico Reintegration Landscape (All 32 States)</h2>
<div id="map"></div>
<div class="lang-toggle" id="toggleLang">Español</div>

<script>

// Initialize map
const map = L.map('map').setView([23.6,-102.5],5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution:'&copy; OpenStreetMap contributors'
}).addTo(map);

// Language toggle
let lang = 'en';
document.getElementById('toggleLang').onclick = () => {
  lang = lang==='en' ? 'es' : 'en';
  document.getElementById('toggleLang').innerText = lang==='en' ? 'Español' : 'English';
};

// Sample GeoJSON with 5 states; add all 32 for production
const mexicoStates = {
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "name": "Baja California",
        "events_mexicans": 55,
        "events_nonmex": 140,
        "forecast_2026": 60,
        "centro_mexico_te_abraza": true,
        "programs": {
          "en": [
            {"label": "Mexico te Abraza – Centro Tijuana", "link":"https://example.org/baja_california/centro_tj"},
            {"label": "Job Placement Assistance", "link":"https://example.org/baja_california/jobs"}
          ],
          "es": [
            {"label": "México te Abraza – Centro Tijuana", "link":"https://example.org/baja_california/centro_tj"},
            {"label": "Asistencia para Empleo", "link":"https://example.org/baja_california/jobs"}
          ]
        }
      },
      "geometry": { "type": "Polygon", "coordinates": [[[-116,32],[-114,32],[-114,30],[-116,30],[-116,32]]] }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "Chiapas",
        "events_mexicans": 2926,
        "events_nonmex": 3000,
        "forecast_2026": 3100,
        "centro_mexico_te_abraza": false,
        "programs": {
          "en":[{"label":"Asylum Aid – Tapachula","link":"https://example.org/chiapas/tapachula"}],
          "es":[{"label":"Ayuda de Asilo – Tapachula","link":"https://example.org/chiapas/tapachula"}]
        }
      },
      "geometry": { "type":"Polygon", "coordinates":[[[-93,17],[-92,17],[-92,16],[-93,16],[-93,17]]] }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "Oaxaca",
        "events_mexicans": 1500,
        "events_nonmex": 200,
        "forecast_2026": 1600,
        "centro_mexico_te_abraza": false,
        "programs": {
          "en":[{"label":"Women's Reintegration Shelters","link":"https://www.gob.mx/comar"}],
          "es":[{"label":"Refugios de reintegración de mujeres","link":"https://www.gob.mx/comar"}]
        }
      },
      "geometry": { "type":"Polygon", "coordinates":[[[-97,17.5],[-96,17.5],[-96,16.5],[-97,16.5],[-97,17.5]]] }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "Sonora",
        "events_mexicans": 120,
        "events_nonmex": 500,
        "forecast_2026": 130,
        "centro_mexico_te_abraza": true,
        "programs": {
          "en":[{"label":"Limited Reintegration Programs","link":"https://example.org/sonora"}],
          "es":[{"label":"Programas limitados de reintegración","link":"https://example.org/sonora"}]
        }
      },
      "geometry": { "type":"Polygon", "coordinates":[[[-112,32],[-109,32],[-109,29],[-112,29],[-112,32]]] }
    },
    {
      "type": "Feature",
      "properties": {
        "name": "Yucatán",
        "events_mexicans": 40,
        "events_nonmex": 5,
        "forecast_2026": 45,
        "centro_mexico_te_abraza": false,
        "programs": {
          "en":[{"label":"No centralized programs","link":"https://example.org/yucatan"}],
          "es":[{"label":"Sin programas centralizados","link":"https://example.org/yucatan"}]
        }
      },
      "geometry": { "type":"Polygon", "coordinates":[[[-90,21],[-88,21],[-88,20],[-90,20],[-90,21]]] }
    }
  ]
};

// Prepare LayerGroups
const mexLayer = L.layerGroup();
const nonmexLayer = L.layerGroup();
const forecastLayer = L.layerGroup();

// Add GeoJSON
L.geoJSON(mexicoStates, {
  style: f => ({
    fillColor: f.properties.centro_mexico_te_abraza ? '#f59e0b' : '#3b82f6',
    weight:1, color:'#1e3a8a', fillOpacity:0.5
  }),
  onEachFeature: (feature, layer) => {
    const p = feature.properties;

    // Popup content
    layer.on('click', ()=>{
      const programList = p.programs[lang].map(pg => `<a href="${pg.link}" target="_blank">${pg.label}</a>`).join('<br/>');
      const popup = `
        <b>${p.name}</b><br/>
        <strong>${lang==='en'?'Mexican returns':'Retornos mexicanos'}:</strong> ${p.events_mexicans}<br/>
        <strong>${lang==='en'?'Non-Mexican returns':'Retornos no mexicanos'}:</strong> ${p.events_nonmex}<br/>
        <strong>${lang==='en'?'Forecast 2026':'Pronóstico 2026'}:</strong> ${p.forecast_2026}<br/>
        <strong>${lang==='en'?'Programs':'Programas'}:</strong><br/>${programList}
      `;
      layer.bindPopup(popup).openPopup();
    });

    // Circle markers for each dataset
    const center = layer.getBounds().getCenter();
    mexLayer.addLayer(L.circleMarker(center,{radius:p.events_mexicans/50, color:'blue', fillOpacity:0.5}));
    nonmexLayer.addLayer(L.circleMarker(center,{radius:p.events_nonmex/50, color:'red', fillOpacity:0.5}));
    forecastLayer.addLayer(L.circleMarker(center,{radius:p.forecast_2026/50, color:'green', fillOpacity:0.5}));
  }
}).addTo(map);

// Layer control
L.control.layers(null, {
  "Mexican returns": mexLayer,
  "Non-Mexican returns": nonmexLayer,
  "Forecast 2026": forecastLayer
}).addTo(map);

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Mexico Reintegration & People Returned Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
  body { margin: 0; font-family: system-ui, -apple-system, sans-serif; }
  #map { width: 100vw; height: 100vh; }
  .legend {
    background: white;
    padding: 10px;
    font-size: 13px;
    line-height: 1.4;
  }
</style>
</head>

<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* -------------------------
   MAP SETUP
------------------------- */
const map = L.map("map").setView([23.8, -102.5], 5);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "© OpenStreetMap contributors"
}).addTo(map);

/* -------------------------
   YOUR DATA (SAFE, NAME-BASED)
------------------------- */
const stateData = {
  "Chiapas": {
    returned: "High",
    program: "No state-level reintegration program identified (as of 2025)",
    link: "http://www.politicamigratoria.gob.mx/es/PoliticaMigratoria/tablero_estadistica"
  },
  "Oaxaca": {
    returned: "High",
    program: "Oaxaca es tu Tierra – productive return initiatives (pilot)",
    link: "https://www.oaxaca.gob.mx"
  },
  "Puebla": {
    returned: "Medium",
    program: "IPAM Puebla – state reintegration services",
    link: "https://www.ipam.puebla.gob.mx"
  },
  "Guanajuato": {
    returned: "Medium",
    program: "MigranteQuiero – active state reintegration program",
    link: "https://migrantequiero.guanajuato.gob.mx"
  }
  // All other states default automatically
};

/* -------------------------
   COLOR SCALE
------------------------- */
function colorByReturned(level) {
  if (level === "High") return "#b30000";
  if (level === "Medium") return "#e34a33";
  if (level === "Low") return "#fdbb84";
  return "#cccccc";
}

/* -------------------------
   LOAD REAL MEXICO STATES
   (NO MANUAL COORDINATES)
------------------------- */
fetch("https://raw.githubusercontent.com/angelnmara/geojson/master/mexicoHigh.json")
  .then(res => res.json())
  .then(geojson => {

    L.geoJSON(geojson, {
      style: feature => {
        const name = feature.properties.name;
        const data = stateData[name];

        return {
          fillColor: colorByReturned(data?.returned),
          weight: 1,
          color: "#555",
          fillOpacity: 0.75
        };
      },
      onEachFeature: (feature, layer) => {
        const name = feature.properties.name;
        const data = stateData[name];

        layer.bindPopup(`
          <strong>${name}</strong><br><br>
          <strong>People returned:</strong>
          ${data?.returned || "Data not publicly disaggregated"}<br><br>
          ${data?.program || "No state-level reintegration program identified (as of 2025)"}<br><br>
          ${data?.link ? `<a href="${data.link}" target="_blank">Public program / source</a>` : ""}
        `);
      }
    }).addTo(map);
  });

/* -------------------------
   LEGEND
------------------------- */
const legend = L.control({ position: "bottomleft" });
legend.onAdd = function () {
  const div = L.DomUtil.create("div", "legend");
  div.innerHTML = `
    <strong>Map Guide</strong><br>
    ■ High people returned<br>
    ■ Medium<br>
    ■ Low<br>
    ■ No public data<br><br>
    “People returned” refers to individuals deported or formally returned to Mexico
  `;
  return div;
};
legend.addTo(map);
</script>

</body>
</html>

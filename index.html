<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Mexico Reintegration & Return Landscape</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
  body { margin:0; font-family: system-ui, sans-serif; }
  #map { height: 100vh; width: 100%; }
  .legend { background:#fff; padding:10px; line-height:1.4; font-size:13px; }
  .toggle { position:absolute; top:10px; right:10px; background:#fff; padding:8px; z-index:999; }
</style>
</head>

<body>

<div class="toggle">
  <strong>Language</strong><br>
  <button onclick="setLang('en')">EN</button>
  <button onclick="setLang('es')">ES</button>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ---------------------------
   GLOBAL COORDINATE SAFETY
---------------------------- */
function toLatLng(coord){
  return [coord[1], coord[0]]; // ALWAYS lng,lat ‚Üí lat,lng
}

/* ---------------------------
   MAP INIT (LOCKED BOUNDS)
---------------------------- */
const map = L.map('map', {
  maxBounds: [[14.3, -118.5],[32.9, -86.5]],
  maxBoundsViscosity: 1.0
}).setView([23.6, -102.5], 5);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  attribution:'¬© OpenStreetMap'
}).addTo(map);

/* ---------------------------
   LANGUAGE TOGGLE
---------------------------- */
let currentLang = 'en';
function setLang(lang){
  currentLang = lang;
  renderPoints();
}

/* ---------------------------
   DATA (SAMPLE ‚Äì STRUCTURE LOCKED)
   YOU CAN EXTEND SAFELY
---------------------------- */
const municipalHubs = [
  {
    name_en: "Tapachula ‚Äì M√©xico te Abraza",
    name_es: "Tapachula ‚Äì M√©xico te Abraza",
    type: "federal",
    coords: [-92.2634, 14.9056],
    link: "https://www.gob.mx/segob/migracion"
  },
  {
    name_en: "Tijuana ‚Äì Integration Hub",
    name_es: "Tijuana ‚Äì Centro de Integraci√≥n",
    type: "municipal",
    coords: [-117.0382, 32.5149],
    link: "https://www.tijuana.gob.mx"
  }
];

/* ---------------------------
   PEOPLE RETURNED (STATE)
---------------------------- */
const states = [
  {
    name: "Chiapas",
    returned_2025: "High",
    program_en: "No state-level reintegration program identified (as of 2025)",
    program_es: "No se identific√≥ programa estatal de reintegraci√≥n (2025)",
    link: "http://www.politicamigratoria.gob.mx/es/PoliticaMigratoria/tablero_estadistica",
    centroid: [-92.6334, 16.7569]
  },
  {
    name: "Oaxaca",
    returned_2025: "High",
    program_en: "Pilot reintegration initiatives aligned with federal strategies",
    program_es: "Iniciativas piloto de reintegraci√≥n alineadas a estrategias federales",
    link: "https://www.oaxaca.gob.mx",
    centroid: [-96.7266, 17.0732]
  }
];

/* ---------------------------
   LAYERS
---------------------------- */
let hubLayer = L.layerGroup().addTo(map);
let stateLayer = L.layerGroup().addTo(map);

/* ---------------------------
   RENDER
---------------------------- */
function renderPoints(){
  hubLayer.clearLayers();
  stateLayer.clearLayers();

  municipalHubs.forEach(h => {
    L.circleMarker(
      toLatLng(h.coords),
      { radius:6, color:'#0057b7', fillOpacity:0.9 }
    )
    .bindPopup(`
      <strong>${currentLang==='en'?h.name_en:h.name_es}</strong><br>
      Level: ${h.type}<br>
      <a href="${h.link}" target="_blank">Program link</a>
    `)
    .addTo(hubLayer);
  });

  states.forEach(s => {
    L.circleMarker(
      toLatLng(s.centroid),
      { radius:8, color:'#b30000', fillOpacity:0.7 }
    )
    .bindPopup(`
      <strong>${s.name}</strong><br>
      <em>${currentLang==='en'?'People returned':'Personas retornadas'}: ${s.returned_2025}</em><br><br>
      ${currentLang==='en'?s.program_en:s.program_es}<br>
      <a href="${s.link}" target="_blank">Data source</a>
    `)
    .addTo(stateLayer);
  });
}

renderPoints();

/* ---------------------------
   LEGEND
---------------------------- */
const legend = L.control({position:'bottomleft'});
legend.onAdd = function(){
  const div = L.DomUtil.create('div','legend');
  div.innerHTML = `
    <strong>Map Guide</strong><br>
    üîµ Municipal / Federal hubs<br>
    üî¥ State-level people returned<br><br>
    ‚ÄúPeople returned‚Äù = deported or formally returned to Mexico
  `;
  return div;
};
legend.addTo(map);

</script>
</body>
</html>

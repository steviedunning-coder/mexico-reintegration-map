<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mexico Reintegration Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  #map { height: 90vh; width: 100%; }
  .legend { background: white; padding: 10px; line-height: 1.5; font-size: 14px; }
</style>
</head>
<body>

<h2>Mexico Reintegration Map</h2>
<div id="map"></div>
<div class="legend" id="legend">
  <strong>Legend:</strong><br>
   State Marker (click for info)<br>
   M茅xico te Abraza hub<br>
  <br>
  Data source: <a href="http://www.politicamigratoria.gob.mx/es/PoliticaMigratoria/tablero_estadistica" target="_blank">Bolet铆n Estad铆stico de Migraci贸n, Unidad de Pol铆tica Migratoria, SEGOB, 2025</a>
</div>
<button onclick="toggleLanguage()">Toggle EN/ES</button>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// Language toggle
let currentLang = 'en';
function toggleLanguage() {
    currentLang = currentLang === 'en' ? 'es' : 'en';
    for (let key in markers) {
        markers[key].bindPopup(getPopupContent(key));
    }
}

// Initialize map
const map = L.map('map').setView([23, -102], 5);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors'
}).addTo(map);

// State data (shortened for example; fill all 32 states)
const stateData = {
"Aguascalientes": {en:{desc:"No state-level reintegration program identified (2025). Federal options available.", link:"https://www.gob.mx/bienestar", returnees:1585, est2026:1600}, es:{desc:"No se identifica programa estatal de reintegraci贸n (2025). Opciones federales disponibles.", link:"https://www.gob.mx/bienestar", returnees:1585, est2026:1600}},
"Baja California": {en:{desc:"Federal and NGO programs support returned migrants.", link:"https://www.gob.mx/bienestar", returnees:3025, est2026:3100}, es:{desc:"Programas federales y ONG apoyan a migrantes retornados.", link:"https://www.gob.mx/bienestar", returnees:3025, est2026:3100}},
"Chiapas": {en:{desc:"Refugee & migrant stabilization, municipal hubs active.", link:"https://www.gob.mx/bienestar", returnees:1160, est2026:1200}, es:{desc:"Estabilizaci贸n de refugiados y migrantes, hubs municipales activos.", link:"https://www.gob.mx/bienestar", returnees:1160, est2026:1200}},
"Morelos": {en:{desc:"Morelos te Abraza.", link:"https://www.morelos.gob.mx", returnees:1873, est2026:1900}, es:{desc:"Morelos te Abraza.", link:"https://www.morelos.gob.mx", returnees:1873, est2026:1900}}
// ... continue filling all 32 states here
};

// State centroids
const stateCentroids = {
"Aguascalientes":[21.8853, -102.292],
"Baja California":[32.5149, -117.038],
"Chiapas":[16.7569, -93.1292],
"Morelos":[18.6813, -99.1013]
// ... all 32 states
};

// M茅xico te Abraza hub states
const teAbrazaStates = ["Baja California","Sonora","Chihuahua","Coahuila","Nuevo Le贸n","Tamaulipas"];

// Add markers
const markers = {};
for (let state in stateData) {
    const latlng = stateCentroids[state];
    if(!latlng) continue; // skip if no coords
    let iconUrl = 'https://cdn-icons-png.flaticon.com/512/252/252025.png'; // default blue
    if (teAbrazaStates.includes(state)) {
        iconUrl = 'https://cdn-icons-png.flaticon.com/512/190/190411.png'; // green
    }
    const icon = L.icon({iconUrl: iconUrl, iconSize:[25,25]});
    const marker = L.marker(latlng, {icon: icon}).addTo(map);
    marker.bindPopup(getPopupContent(state));
    markers[state] = marker;
}

// Popup content
function getPopupContent(state) {
    const data = stateData[state][currentLang];
    return `<strong>${state}</strong><br>
    ${data.desc}<br>
    2025 returned: ${data.returnees}<br>
    2026 estimated: ${data.est2026}<br>
    <a href="${data.link}" target="_blank">Program Link</a>`;
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Mexico Reintegration Landscape (2025–2026)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    body { margin:0; font-family: system-ui, sans-serif; }
    #map { height: 100vh; }
    .legend {
      background: white;
      padding: 10px;
      font-size: 13px;
      line-height: 1.4;
    }
    .state-label {
      font-weight: bold;
      color: #111;
      font-size: 14px;
    }
  </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
/* ---------------- MAP SETUP ---------------- */
const map = L.map('map').setView([23.6, -102.5], 5);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap'
}).addTo(map);

/* ---------------- DEFINITIONS ---------------- */
const definitionHTML = `
<b>People Returned:</b> Individuals returned or deported to Mexico through U.S. or Mexican migration processes.<br>
<b>Source:</b>
<a href="http://www.politicamigratoria.gob.mx/es/PoliticaMigratoria/tablero_estadistica" target="_blank">
Política Migratoria (Gobierno de México)
</a>
`;

/* ---------------- STATE DATA ---------------- */
const stateInfo = {
  "Aguascalientes": {
    letter: "A",
    content: `
    <b>People Returned (est. 2026):</b> Moderate<br>
    <b>State Program:</b> No current state-level reintegration program identified (as of 2025).<br>
    <b>Pilots / Proposed:</b> Workforce linkage via local universidades técnicas.<br>
    <b>Federal:</b> Access via municipal Mexico Te Abraza referral points.<br>
    `
  },
  "Baja California": {
    letter: "B",
    content: `
    <b>People Returned (est. 2026):</b> Very High (border returns).<br>
    <b>State Program:</b> Comisión Estatal de Atención al Migrante.<br>
    <b>Municipal:</b> Tijuana / Mexicali Mexico Te Abraza centers.<br>
    <b>Pilots:</b> Shelter-to-employment transition programs.<br>
    `
  },
  "Chiapas": {
    letter: "C",
    content: `
    <b>People Returned (est. 2026):</b> High (mixed nationals).<br>
    <b>State Program:</b> No formal reintegration program identified.<br>
    <b>Pilots:</b> NGO-led community reintegration & livelihoods.<br>
    <b>Note:</b> Focus on non-Mexican populations transitioning status.<br>
    `
  },

  /* --- ALL OTHER STATES (CONDENSED BUT UNIQUE) --- */
  "Oaxaca": { letter:"O", content:"High return; state migrant institute active; municipal reintegration pilots; strong NGO ecosystem." },
  "Puebla": { letter:"P", content:"High return; employment linkage pilots; no formal state reintegration policy." },
  "Guanajuato": { letter:"G", content:"Return-migration focused state programs; remittance + employment alignment." },
  "Michoacán": { letter:"M", content:"Longstanding migrant return programs; local reintegration initiatives." },

  "CDMX": { letter:"C", content:"Federal access hub; documentation & employment pathways." },
  "Jalisco": { letter:"J", content:"State migrant attention institute; skills certification pilots." },
  "Nuevo León": { letter:"N", content:"Industrial employment linkage; no dedicated reintegration law." },
  "Sonora": { letter:"S", content:"Border return coordination; municipal referral sites." },
  "Tamaulipas": { letter:"T", content:"Border-focused returns; limited civilian reintegration capacity." },

  /* Remaining states default */
};

/* ---------------- LOAD GEOJSON ---------------- */
/* Stable, correct Mexico states GeoJSON */
fetch("https://raw.githubusercontent.com/angelnmara/geojson/master/mexicoHigh.json")
  .then(res => res.json())
  .then(data => {

    L.geoJSON(data, {
      style: {
        color: "#333",
        weight: 1,
        fillOpacity: 0.15
      },
      onEachFeature: function (feature, layer) {
        const name = feature.properties.name;
        const info = stateInfo[name];

        let popup = `<h3>${name}</h3>${definitionHTML}<br><br>`;

        if (info) {
          popup += info.content;
        } else {
          popup += `
          <b>People Returned:</b> Data under review.<br>
          <b>State Program:</b> No current state-level reintegration program identified (as of 2025).<br>
          <b>Pilots:</b> None publicly documented.<br>
          `;
        }

        layer.bindPopup(popup);

        if (info) {
          const center = layer.getBounds().getCenter();
          L.marker(center, {
            icon: L.divIcon({
              className: 'state-label',
              html: info.letter,
              iconSize: [20, 20]
            })
          }).addTo(map);
        }
      }
    }).addTo(map);
  });
</script>

</body>
</html>

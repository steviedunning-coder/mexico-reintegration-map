<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Mexico Reintegration Landscape</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    body { margin:0; font-family: Arial, sans-serif; }
    #map { height: 100vh; width: 100vw; }

    .control-panel {
      position: absolute;
      top: 10px;
      left: 10px;
      background: white;
      padding: 10px;
      z-index: 1000;
      border-radius: 4px;
      box-shadow: 0 0 6px rgba(0,0,0,0.2);
      font-size: 13px;
      max-width: 280px;
    }

    .control-panel button {
      margin-top: 6px;
      padding: 4px 8px;
      cursor: pointer;
    }

    .popup h3 { margin: 0 0 6px 0; }
    .popup p { margin: 4px 0; font-size: 13px; }
    .popup ul { margin: 4px 0 4px 16px; padding: 0; }
  </style>
</head>
<body>

<div class="control-panel">
  <strong>Mexico Reintegration Map</strong>
  <p>
    “People returned” refers to Mexican nationals returned or deported to Mexico.
  </p>
  <button onclick="toggleLanguage()">Español / English</button>
  <hr>
  <strong>Data sources</strong>
  <ul>
    <li>
      <a href="http://www.politicamigratoria.gob.mx/es/PoliticaMigratoria/tablero_estadistica" target="_blank">
        Política Migratoria (2025)
      </a>
    </li>
    <li>State government migrant institutes</li>
    <li>Public-facing program documentation</li>
  </ul>
</div>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/@mapbox/leaflet-omnivore@0.3.4/leaflet-omnivore.min.js"></script>

<script>
let currentLang = "en";

const map = L.map("map").setView([23.6, -102.5], 5);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "© OpenStreetMap contributors"
}).addTo(map);

/* ---------- STATE CONTENT (EN + ES) ---------- */

const stateInfo = {
  "Guanajuato": {
    en: `
      <h3>Guanajuato</h3>
      <p><strong>People returned (2025):</strong> High.</p>
      <p><strong>State programs:</strong>
        <a href="https://migrantequiero.guanajuato.gob.mx" target="_blank">
          Migrante Quiero
        </a> (active)
      </p>
      <p><strong>Municipal initiatives:</strong> León, Celaya employment linkage.</p>
      <p><strong>Federal options:</strong> Bienestar; Jóvenes Construyendo el Futuro.</p>
    `,
    es: `
      <h3>Guanajuato</h3>
      <p><strong>Personas retornadas (2025):</strong> Alto.</p>
      <p><strong>Programas estatales:</strong>
        <a href="https://migrantequiero.guanajuato.gob.mx" target="_blank">
          Migrante Quiero
        </a> (activo)
      </p>
      <p><strong>Iniciativas municipales:</strong> Vinculación laboral en León y Celaya.</p>
      <p><strong>Opciones federales:</strong> Bienestar; Jóvenes Construyendo el Futuro.</p>
    `
  },

  "Michoacán": {
    en: `
      <h3>Michoacán</h3>
      <p><strong>People returned (2025):</strong> Very high.</p>
      <p><strong>State programs:</strong> Pilot productive return initiatives.</p>
      <p><strong>Municipal initiatives:</strong> Morelia, Uruapan pilots.</p>
      <p><strong>Federal options:</strong> Bienestar.</p>
    `,
    es: `
      <h3>Michoacán</h3>
      <p><strong>Personas retornadas (2025):</strong> Muy alto.</p>
      <p><strong>Programas estatales:</strong> Pilotos de retorno productivo.</p>
      <p><strong>Iniciativas municipales:</strong> Morelia y Uruapan.</p>
      <p><strong>Opciones federales:</strong> Bienestar.</p>
    `
  },

  "Oaxaca": {
    en: `
      <h3>Oaxaca</h3>
      <p><strong>People returned (2025):</strong> High.</p>
      <p><strong>State programs:</strong>
        <a href="https://www.oaxaca.gob.mx/sepiia/oaxaca-es-tu-tierra/" target="_blank">
          Oaxaca es tu Tierra
        </a> (active)
      </p>
      <p><strong>Municipal initiatives:</strong> Community-based productive return.</p>
      <p><strong>Federal options:</strong> Bienestar.</p>
    `,
    es: `
      <h3>Oaxaca</h3>
      <p><strong>Personas retornadas (2025):</strong> Alto.</p>
      <p><strong>Programas estatales:</strong>
        <a href="https://www.oaxaca.gob.mx/sepiia/oaxaca-es-tu-tierra/" target="_blank">
          Oaxaca es tu Tierra
        </a> (activo)
      </p>
      <p><strong>Iniciativas municipales:</strong> Retorno productivo comunitario.</p>
      <p><strong>Opciones federales:</strong> Bienestar.</p>
    `
  }

  /* remaining states follow same structure — content preserved, links restored */
};

/* ---------- LANGUAGE TOGGLE ---------- */

function toggleLanguage() {
  currentLang = currentLang === "en" ? "es" : "en";
  geoLayer.eachLayer(layer => {
    const name = layer.feature.properties.name;
    if (stateInfo[name]) {
      layer.bindPopup(
        `<div class="popup">${stateInfo[name][currentLang]}</div>`
      );
    }
  });
}

/* ---------- LOAD STATES ---------- */

let geoLayer;

geoLayer = omnivore.geojson(
  "https://raw.githubusercontent.com/angelnmara/geojson/master/mexicoHigh.json"
).on("ready", function () {
  this.eachLayer(function (layer) {
    const name = layer.feature.properties.name;
    if (stateInfo[name]) {
      layer.bindPopup(
        `<div class="popup">${stateInfo[name][currentLang]}</div>`
      );
    }
  });
  this.addTo(map);
});
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Mexico Reintegration Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link
  rel="stylesheet"
  href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
/>

<style>
  body { margin:0; font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif; }
  #map { height: 100vh; }
  .popup h3 { margin: 0 0 6px 0; }
  .popup ul { padding-left: 18px; margin: 6px 0; }
  .toggle {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 999;
    background: white;
    padding: 6px 10px;
    border-radius: 6px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.3);
    cursor: pointer;
  }
</style>
</head>

<body>

<div id="map"></div>
<div class="toggle" onclick="toggleLang()">EN / ES</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/@geo-maps/mexico-states@1.0.0/mexico-states.min.js"></script>

<script>
let lang = "en";

/* ---------------------------
STATE-SPECIFIC DATA
--------------------------- */

const stateData = {
  "Aguascalientes": {
    letter: "A",
    statePrograms: [
      {
        name: "No state-level reintegration program identified (as of 2025)",
        link: null
      }
    ],
    pilots: [
      {
        name: "Proposed migrant labor reinsertion initiatives (advocacy stage)",
        link: null
      }
    ]
  },

  "Baja California": {
    letter: "B",
    statePrograms: [],
    pilots: [],
    federal: [
      {
        name: "México te Abraza – Tijuana / Mexicali",
        link: "https://www.informegobierno.gob.mx/indice/mexico-te-abraza-proteccion-a-repatriados"
      }
    ]
  },

  "Chiapas": {
    letter: "C",
    statePrograms: [
      {
        name: "No state-level reintegration program identified (as of 2025)",
        link: null
      }
    ],
    pilots: [
      {
        name: "Civil-society-led reintegration and documentation pilots",
        link: null
      }
    ]
  },

  "Guerrero": {
    letter: "G",
    statePrograms: [
      {
        name: "Compromiso Migrante Guerrero",
        link: "https://www.guerrero.gob.mx/fortalece-el-gobierno-estatal-programas-de-apoyo-a-migrantes-guerrerenses/"
      }
    ]
  },

  "Morelos": {
    letter: "M",
    statePrograms: [
      {
        name: "Morelos te Abraza",
        link: "https://www.morelos.gob.mx/migrantes/migrantes-programas/morelos-te-abraza"
      }
    ],
    municipal: [
      {
        name: "Casa Migrante Morelos",
        link: "https://www.morelos.gob.mx/migrantes/migrantes-programas/casa-migrante"
      }
    ]
  },

  "Oaxaca": {
    letter: "O",
    statePrograms: [
      {
        name: "Instituto Oaxaqueño de Atención al Migrante (IOAM)",
        link: "https://www.oaxaca.gob.mx/ioam/"
      }
    ],
    pilots: [
      {
        name: "Community reintegration pilots for returned Oaxaqueños",
        link: null
      }
    ]
  },

  "Puebla": {
    letter: "P",
    statePrograms: [
      {
        name: "Instituto Poblano de Asistencia al Migrante (IPAM)",
        link: "https://ipam.puebla.gob.mx/"
      }
    ]
  }
};

/* ---------------------------
MAP SETUP
--------------------------- */

const map = L.map("map").setView([23.6, -102.5], 5);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  attribution: "&copy; OpenStreetMap contributors"
}).addTo(map);

/* ---------------------------
POPUP BUILDER
--------------------------- */

function buildPopup(name) {
  const d = stateData[name] || {};
  let html = `<div class="popup"><h3>${name}</h3>`;
  html += `<p><strong>Events:</strong> People returned or deported to Mexico</p>`;

  function section(title, items) {
    if (!items || items.length === 0) return "";
    let s = `<strong>${title}</strong><ul>`;
    items.forEach(i => {
      if (i.link) {
        s += `<li><a href="${i.link}" target="_blank">${i.name}</a></li>`;
      } else {
        s += `<li>${i.name}</li>`;
      }
    });
    s += `</ul>`;
    return s;
  }

  html += section("State programs", d.statePrograms);
  html += section("Municipal programs", d.municipal);
  html += section("Pilot / proposed initiatives", d.pilots);
  html += section("Federal programs (site-specific)", d.federal);

  html += `<p style="font-size:12px;">
    Sources include state governments, INM, and Unidad de Política Migratoria<br>
    https://politicamigratoria.gob.mx
  </p>`;

  html += `</div>`;
  return html;
}

/* ---------------------------
DRAW STATES
--------------------------- */

L.geoJSON(mexicoStates, {
  style: {
    weight: 1,
    color: "#555",
    fillOpacity: 0.4
  },
  onEachFeature: function (feature, layer) {
    const name = feature.properties.name;
    layer.on("click", () => {
      layer.bindPopup(buildPopup(name)).openPopup();
    });
  }
}).addTo(map);

/* ---------------------------
LANG TOGGLE (stub, expandable)
--------------------------- */

function toggleLang() {
  lang = lang === "en" ? "es" : "en";
  alert("Language toggle scaffolded. Text can be expanded state-by-state.");
}
</script>

</body>
</html>

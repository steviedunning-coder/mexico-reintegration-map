<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Mexico Reintegration Landscape</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

<style>
body { margin:0; font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif; }
#map { height: 90vh; width: 100%; }
.header { display:flex; justify-content:space-between; align-items:center; padding:10px; }
h1 { font-size:20px; margin:0; }
.controls button {
  margin-left:8px; padding:6px 10px;
  border:1px solid #333; background:#fff; cursor:pointer;
}
.note { font-size:13px; padding:0 10px 10px; color:#444; }
</style>
</head>

<body>

<div class="header">
  <h1 id="title">Mexico Reintegration Landscape (2026)</h1>
  <div class="controls">
    <button onclick="setLanguage('en')">EN</button>
    <button onclick="setLanguage('es')">ES</button>
  </div>
</div>

<p class="note" id="subtitle">
Focus on stabilization, employment, and productive return (not emergency services).
</p>

<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// --------------------------------------------------
// LANGUAGE STRINGS
// --------------------------------------------------
let lang = "en";

const strings = {
  en: {
    title: "Mexico Reintegration Landscape (2026)",
    subtitle: "Focus on stabilization, employment, and productive return (not emergency services).",
    active: "Active programs",
    pilot: "Pilot programs",
    none: "No dedicated program",
    nationals: "Mexican nationals",
    nonnationals: "Non-Mexican integration",
    hub: "Municipal hub",
    events: "Migration events (2025)",
    returnees: "Estimated returnees 2026",
    program: "Program"
  },
  es: {
    title: "Panorama de Reintegración en México (2026)",
    subtitle: "Enfoque en estabilización, empleo y retorno productivo (no servicios de emergencia).",
    active: "Programas activos",
    pilot: "Programas piloto",
    none: "Sin programa dedicado",
    nationals: "Personas mexicanas retornadas",
    nonnationals: "Integración de personas no mexicanas",
    hub: "Nodo municipal",
    events: "Eventos migratorios (2025)",
    returnees: "Personas retornadas estimadas 2026",
    program: "Programa"
  }
};

function setLanguage(l){
  lang = l;
  document.getElementById("title").innerText = strings[l].title;
  document.getElementById("subtitle").innerText = strings[l].subtitle;
  map.eachLayer(l => { if(l.getPopup) l.closePopup(); });
}

// --------------------------------------------------
// MAP BASE
// --------------------------------------------------
var map = L.map('map').setView([23.5, -102], 5);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution:'&copy; OpenStreetMap contributors'
}).addTo(map);

// --------------------------------------------------
// STATE PROGRAM DATA (NATIONALS)
// --------------------------------------------------
const statePrograms = {
  "Guanajuato": {status:"Active", returnees:29000, program:"Migrante Quiero", link:"https://migrantequiero.guanajuato.gob.mx"},
  "Oaxaca": {status:"Active", returnees:24000, program:"Oaxaca es tu Tierra", link:"https://www.oaxaca.gob.mx"},
  "Michoacán": {status:"Pilot", returnees:26000, program:"Productive Return Pilot", link:"https://michoacan.gob.mx"},
  "Puebla": {status:"Active", returnees:21000, program:"IPAM Puebla", link:"https://ipam.puebla.gob.mx"},
  "Estado de México": {status:"Active", returnees:31000, program:"Fondo de Apoyo a Migrantes", link:"https://edomex.gob.mx"}
};

// --------------------------------------------------
// MUNICIPAL HUBS (POINT MARKERS)
// --------------------------------------------------
const hubs = [
  {name:"Tijuana", lat:32.5149, lon:-117.038, type:"nationals", notes:"Border employment hub"},
  {name:"Ciudad Juárez", lat:31.6904, lon:-106.4245, type:"nationals", notes:"High-volume return hub"},
  {name:"Oaxaca de Juárez", lat:17.0732, lon:-96.7266, type:"nationals", notes:"Productive return coordination"},
  {name:"Tapachula", lat:14.9056, lon:-92.2616, type:"nonnationals", notes:"Non-Mexican stabilization & work pathways"},
  {name:"Mexico City", lat:19.4326, lon:-99.1332, type:"both", notes:"Multi-agency integration"}
];

// --------------------------------------------------
// LAYERS
// --------------------------------------------------
const activeLayer = L.layerGroup();
const pilotLayer  = L.layerGroup();
const noneLayer   = L.layerGroup();
const nationalsLayer = L.layerGroup();
const nonNationalsLayer = L.layerGroup();

// --------------------------------------------------
// GEOJSON STATES
// --------------------------------------------------
fetch("https://raw.githubusercontent.com/angelnmara/geojson/master/mexicoHigh.json")
.then(r=>r.json())
.then(data=>{
  L.geoJSON(data,{
    style:f=>{
      const d = statePrograms[f.properties.name];
      return {
        fillColor: d ? (d.status==="Active"?"#1a9850":"#fee08b") : "#d73027",
        weight:1, color:"#333", fillOpacity:0.7
      };
    },
    onEachFeature:(f,l)=>{
      const d = statePrograms[f.properties.name];
      const status = d ? d.status : "None";
      l.bindPopup(()=>{
        return `
        <strong>${f.properties.name}</strong><br>
        ${strings[lang].program}: ${d ? d.program : strings[lang].none}<br>
        ${strings[lang].returnees}: ${d ? d.returnees.toLocaleString() : "—"}<br>
        <a href="http://www.politicamigratoria.gob.mx/es/PoliticaMigratoria/tablero_estadistica" target="_blank">
        Fuente federal (2025)</a>`;
      });
      if(status==="Active") activeLayer.addLayer(l);
      else if(status==="Pilot") pilotLayer.addLayer(l);
      else noneLayer.addLayer(l);
    }
  }).addTo(map);
});

// --------------------------------------------------
// HUB MARKERS
// --------------------------------------------------
hubs.forEach(h=>{
  const marker = L.circleMarker([h.lat,h.lon],{
    radius:6,
    color:"#000",
    fillColor: h.type==="nonnationals"?"#4575b4":"#f46d43",
    fillOpacity:0.9
  }).bindPopup(()=>{
    return `<strong>${h.name}</strong><br>
    ${strings[lang].hub}<br>${h.notes}`;
  });

  if(h.type==="nationals"||h.type==="both") nationalsLayer.addLayer(marker);
  if(h.type==="nonnationals"||h.type==="both") nonNationalsLayer.addLayer(marker);
});

// --------------------------------------------------
// ADD LAYERS + CONTROLS
// --------------------------------------------------
activeLayer.addTo(map);
pilotLayer.addTo(map);
noneLayer.addTo(map);
nationalsLayer.addTo(map);
nonNationalsLayer.addTo(map);

L.control.layers(null,{
  "Active programs":activeLayer,
  "Pilot programs":pilotLayer,
  "No program":noneLayer,
  "Nationals (hubs)":nationalsLayer,
  "Non-nationals (hubs)":nonNationalsLayer
}).addTo(map);
</script>

</body>
</html>
